import{_ as E,n as V,a as R,s as ae,b as re,c as le,r as ie}from"./_plugin-vue_export-helper.C1BGYAOa.js";import{d as I,c as p,l as u,b as t,F as K,m as L,o as J,p as z,e as b,g as N,k as D,q as Q,f as B,u as O,x as ue,r as k,y as ce,z as j,A as de,s as W,B as me,j as A,C as P}from"./runtime-core.esm-bundler.BEDpYmWA.js";/* empty css                        */import"./router.C7hpXdoi.js";const fe=I({__name:"VirtualKeypad",emits:["input","delete","confirm"],setup(f,{expose:a,emit:o}){a();const e=o,s=["1","2","3","4","5","6","7","8","9",".","0","\\"],i=m=>{e("input",m)},n=()=>{e("delete")},l=()=>{e("confirm")},d=m=>{s.includes(m.key)?i(m.key):m.key==="Backspace"?n():m.key==="Enter"&&l()};J(()=>{window.addEventListener("keydown",d)}),z(()=>{window.removeEventListener("keydown",d)});const v={emit:e,keys:s,handleInput:i,handleDelete:n,handleConfirm:l,handleKeyboard:d};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}}),pe={class:"grid grid-cols-3 gap-2 p-4 bg-base-100 rounded-t-2xl shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] fixed bottom-0 left-0 right-0 w-full max-w-md mx-auto z-50 pb-8"},ge=["onClick"];function ve(f,a,o,e,s,i){return u(),p("div",pe,[(u(),p(K,null,L(e.keys,n=>t("button",{key:n,onClick:l=>e.handleInput(n),class:"btn btn-lg font-bold bg-base-200 hover:bg-base-300 active:bg-base-300 border-none shadow-sm active:scale-95 transition-transform"},b(n==="\\"?"分之":n),9,ge)),64)),t("button",{onClick:e.handleDelete,class:"btn btn-lg btn-soft btn-secondary text-xl font-bold border-none shadow-sm active:scale-95 transition-transform"}," ⌫ "),t("button",{onClick:e.handleConfirm,class:"btn btn-lg btn-soft btn-primary text-xl font-bold border-none shadow-sm col-span-2 active:scale-95 transition-transform"}," 确定 ")])}const be=E(fe,[["render",ve]]),he=I({__name:"Summary",props:{results:{},totalTime:{},storageKey:{}},emits:["restart"],setup(f,{expose:a,emit:o}){a();const e=f,s=o,i=D(()=>e.results.filter(g=>g.isCorrect).length),n=D(()=>e.results.length-i.value),l=D(()=>e.results.length===0?0:Math.round(i.value/e.results.length*100)),x={props:e,emit:s,correctCount:i,wrongCount:n,accuracy:l,formatTime:g=>{const M=Math.floor(g/6e4).toString().padStart(2,"0"),y=Math.floor(g%6e4/1e3).toString().padStart(2,"0"),c=(g%1e3).toString().padStart(3,"0");return`${M}:${y}.${c}`},goBack:()=>{V()},handleRestart:()=>{R(e.storageKey),s("restart")}};return Object.defineProperty(x,"__isScriptSetup",{enumerable:!1,value:!0}),x}}),_e={class:"flex flex-col h-dvh gap-6 p-4 w-full max-w-2xl mx-auto"},xe={class:"stats shadow w-full bg-base-100 flex-none"},ye={class:"stat place-items-center"},we={class:"stat-value text-primary"},ke={class:"stat place-items-center"},Ce={class:"stat-desc"},Te={class:"overflow-y-auto flex-1 bg-base-100 rounded-box shadow"},Be={class:"table table-zebra w-full table-pin-rows"},Se={class:"font-mono text-lg"},De={class:"font-mono text-lg text-base-content/70"},Fe={class:"font-mono text-sm"};function Qe(f,a,o,e,s,i){return u(),p("div",_e,[t("div",xe,[t("div",ye,[a[0]||(a[0]=t("div",{class:"stat-title"},"总用时",-1)),t("div",we,b(e.formatTime(o.totalTime)),1)]),t("div",ke,[a[1]||(a[1]=t("div",{class:"stat-title"},"正确率",-1)),t("div",{class:N(["stat-value",e.accuracy>=80?"text-success":"text-warning"])},b(e.accuracy)+"% ",3),t("div",Ce,b(e.correctCount)+" 正确, "+b(e.wrongCount)+" 错误",1)])]),t("div",Te,[t("table",Be,[a[2]||(a[2]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"问题"),t("th",null,"回答"),t("th",null,"正确答案"),t("th",null,"用时")])],-1)),t("tbody",null,[(u(!0),p(K,null,L(o.results,(n,l)=>(u(),p("tr",{key:l,class:N({"bg-error/10":!n.isCorrect})},[t("th",null,b(l+1),1),t("td",Se,[Q(f.$slots,"question",{result:n})]),t("td",{class:N(["font-mono text-lg font-bold",n.isCorrect?"text-success":"text-error"])},[Q(f.$slots,"userAnswer",{result:n})],2),t("td",De,[Q(f.$slots,"correctAnswer",{result:n})]),t("td",Fe,[Q(f.$slots,"timeSpent",{result:n},()=>[B(b(e.formatTime(n.timeSpent)),1)])])],2))),128))])])]),t("div",{class:"flex justify-center gap-4 mt-4 flex-none"},[t("button",{onClick:e.goBack,class:"btn btn-outline flex-1 max-w-40"},"返回"),t("button",{onClick:e.handleRestart,class:"btn btn-primary flex-1 max-w-40"},"再来一次")])])}const Ee=E(he,[["render",Qe]]),Ie=I({__name:"MathDisplay",props:{value:{}},setup(f,{expose:a}){a();const o=f,e=D(()=>{const i=o.value;if(!i)return[{type:"text",value:""}];const n=/(?<!\\)([\d?|]+\s*\\\s*[\d?|]+)(?!\\)/g,l=[];let d=0,v;for(;(v=n.exec(i))!==null;){v.index>d&&l.push({type:"text",value:i.slice(d,v.index)});const m=v[0].split("\\");l.push({type:"fraction",denominator:m[0].trim(),numerator:m[1].trim()}),d=n.lastIndex}return d<i.length&&l.push({type:"text",value:i.slice(d)}),l}),s={props:o,segments:e};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}}),Me={class:"inline-flex items-center justify-center align-middle flex-wrap"},Ae={key:0,class:"inline-flex flex-col items-center mx-[0.1em] leading-none",style:{"vertical-align":"middle"}},Pe={class:"border-b-[0.08em] border-current px-[0.2em] pb-[0.1em] text-[0.75em] leading-none text-center block"},Ke={class:"px-[0.2em] pt-[0.1em] text-[0.75em] leading-none text-center block"},$e={key:1,class:"whitespace-pre"};function Re(f,a,o,e,s,i){return u(),p("span",Me,[(u(!0),p(K,null,L(e.segments,(n,l)=>(u(),p(K,{key:l},[n.type==="fraction"?(u(),p("span",Ae,[t("span",Pe,b(n.numerator),1),t("span",Ke,b(n.denominator),1)])):(u(),p("span",$e,b(n.value),1))],64))),128))])}const Ne=E(Ie,[["render",Re]]),je=I({__name:"TopBar",props:{startTime:{},currentQuestion:{},totalQuestions:{}},setup(f,{expose:a}){a();const o=f,e=k("00:00");let s=null;const i=()=>{V()},n=m=>{const x=Math.floor(m/60).toString().padStart(2,"0"),g=Math.floor(m%60).toString().padStart(2,"0");return`${x}:${g}`},l=()=>{s&&clearInterval(s),e.value="00:00",s=window.setInterval(()=>{o.startTime&&(e.value=n((Date.now()-o.startTime)/1e3))},100)},d=()=>{s&&(clearInterval(s),s=null)};ce(()=>{o.startTime&&(o.startTime===-1?d():l())}),z(()=>{d()});const v={props:o,time:e,get timerInterval(){return s},set timerInterval(m){s=m},goBack:i,formatTime:n,startTimer:l,stopTimer:d};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}}),qe={class:"flex-none flex items-center gap-4"},Oe={key:0,class:"text-sm uppercase tracking-widest opacity-50"},Ve={class:"font-mono text-xl font-bold text-primary"};function Le(f,a,o,e,s,i){return u(),p("div",ue(f.$attrs,{class:"navbar bg-base-100 shadow-md px-4 min-h-12"}),[t("div",{class:"flex-1"},[t("button",{onClick:e.goBack,class:"btn btn-ghost btn-sm gap-2"},[...a[0]||(a[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})],-1),B(" 返回 ",-1)])])]),t("div",qe,[o.totalQuestions?(u(),p("div",Oe,b(o.currentQuestion)+" / "+b(o.totalQuestions),1)):O("",!0),t("div",Ve,b(e.time),1)])],16)}const ze=E(je,[["render",Le]]),X=1800*1e3,Y="flag:nav-from-training",Ge=I({__name:"BaseTraining",props:{type:{},numQuestions:{},generateQuestion:{type:Function},isRight:{type:Function},storageKey:{}},emits:["complete"],setup(f,{expose:a,emit:o}){a();const e={correct:"#22c55e",wrong:"#ef4444",pending:"#ffffff"},s=f,i=o,n=k(!1),l=W([]),d=k(0),v=k("none"),m=k(0),x=k(0),g=W([]),M=k(null);let y=null;const c=()=>{ae(s.storageKey,{questions:l.value,startTime:m.value,questionStartTime:x.value,results:g.value,savedAt:Date.now(),numQuestions:s.numQuestions})},_=()=>{const r=re(s.storageKey);return r?Date.now()-r.savedAt>X?(R(s.storageKey),!1):r.numQuestions!==s.numQuestions?(R(s.storageKey),!1):(l.value=r.questions,d.value=Math.min(r.results.length,r.questions.length-1),m.value=r.startTime,x.value=r.questionStartTime,g.value=r.results,n.value=!0,r):!1},h=()=>{y=r=>{r.preventDefault(),M.value?.showModal()},document.addEventListener("astro:before-preparation",y)},w=()=>{y&&(document.removeEventListener("astro:before-preparation",y),y=null)},S=()=>{w(),R(s.storageKey),V()},Z=()=>{n.value=!0;const r=[];for(let C=0;C<s.numQuestions;C++)r.push(s.generateQuestion());l.value=r,m.value=Date.now(),x.value=Date.now(),d.value=0,c(),h()},q=D(()=>{if(l.value.length!==0)return l.value[d.value]}),ee=r=>{if(v.value!=="none"||!q.value)return Promise.resolve();const C=q.value,F=s.isRight(C,r),T=Date.now()-x.value;g.value.push({question:C,userAnswer:r,isCorrect:F,timeSpent:T}),me(g),v.value=F?"correct":"wrong",c(),d.value<l.value.length-1?(d.value++,x.value=Date.now()):G(),setTimeout(()=>{v.value="none"},300)},G=()=>{w();const r=Date.now()-m.value;if(s.storageKey){const C=g.value.filter(T=>T.isCorrect).length,F={timestamp:m.value,numQuestions:s.numQuestions,correctCount:C,avgTimePerQuestion:Math.round(r/s.numQuestions),totalTime:r};le(s.storageKey,F)}m.value=-1,setTimeout(()=>{i("complete",g.value,r)},500)};J(()=>{const r=_();r&&(g.value.length===s.numQuestions?i("complete",g.value,r.savedAt-r.startTime):h())}),z(()=>{w()});const te=D(()=>ie(`/statistics/${s.type}`)),ne=()=>{sessionStorage.setItem(Y,"1")},se=D(()=>{const r=s.numQuestions;if(r===0)return"linear-gradient(to right, white 100%)";const C=[],F=100/r;for(let T=0;T<r;T++){const H=g.value[T];let $;H===void 0?$=e.pending:H.isCorrect?$=e.correct:$=e.wrong;const oe=(T+.5)*F;C.push(`${$} ${oe}%`)}return`linear-gradient(to right, ${C.join(", ")})`}),U={COLORS:e,props:s,emit:i,STORAGE_MAX_AGE:X,started:n,questions:l,currentQuestionIndex:d,feedback:v,startTime:m,questionStartTime:x,results:g,confirmModal:M,get navigationHandler(){return y},set navigationHandler(r){y=r},saveProgress:c,loadProgress:_,setupNavigationInterception:h,cleanupNavigationInterception:w,performNavigation:S,startTraining:Z,currentQuestion:q,handleConfirm:ee,finish:G,NAV_FROM_TRAINING_KEY:Y,statisticsUrl:te,goToStatistics:ne,progressGradient:se,TopBar:ze};return Object.defineProperty(U,"__isScriptSetup",{enumerable:!1,value:!0}),U}}),Ue={class:"flex flex-col items-center w-full overflow-x-hidden flex-1 relative"},He={key:1,class:"mb-6"},We={key:2,class:"card w-full bg-base-100 shadow-xl"},Xe={class:"card-body items-center text-center"},Ye={class:"card-actions mt-8 w-full justify-between"},Je=["href"],Ze={key:3,class:"w-full flex flex-col items-center flex-1"},et={ref:"confirmModal",class:"modal"};function tt(f,a,o,e,s,i){return u(),p("div",Ue,[j(e.TopBar,{startTime:e.startTime,currentQuestion:e.currentQuestionIndex+1,totalQuestions:o.numQuestions,class:"w-full"},null,8,["startTime","currentQuestion","totalQuestions"]),e.started?(u(),p("div",{key:0,class:N(["progress-bar w-full h-2 mb-4",{"feedback-correct":e.feedback==="correct","feedback-wrong":e.feedback==="wrong"}]),style:de({background:e.progressGradient})},null,6)):(u(),p("div",He)),e.started?O("",!0):(u(),p("div",We,[t("div",Xe,[Q(f.$slots,"description",{},void 0,!0),t("div",Ye,[t("a",{href:e.statisticsUrl,class:"btn btn-link",onClick:e.goToStatistics},"历史统计",8,Je),t("button",{class:"btn btn-primary btn-lg",onClick:e.startTraining},"开始训练")])])])),e.started&&e.currentQuestion?(u(),p("div",Ze,[Q(f.$slots,"default",{question:e.currentQuestion,feedback:e.feedback,confirm:e.handleConfirm},void 0,!0)])):O("",!0),t("dialog",et,[t("div",{class:"modal-box"},[a[1]||(a[1]=t("h3",{class:"font-bold text-lg"},"提示",-1)),a[2]||(a[2]=t("p",{class:"py-4"},"确定要退出训练吗？当前进度将丢失。",-1)),t("div",{class:"modal-action"},[t("form",{method:"dialog"},[a[0]||(a[0]=t("button",{class:"btn"},"取消",-1)),t("button",{class:"btn btn-error ml-2",onClick:e.performNavigation},"确定退出")])])]),a[3]||(a[3]=t("form",{method:"dialog",class:"modal-backdrop"},[t("button",null,"close")],-1))],512)])}const nt=E(Ge,[["render",tt],["__scopeId","data-v-e4e72e52"]]),st=I({__name:"FractionPercentage",props:{numQuestions:{},type:{},storageKey:{}},setup(f,{expose:a}){a();const o=k(""),e=k(!1),s=k([]),i=k(0),n=c=>Number.isInteger(c)?c.toString():Number.isInteger(c*10)?c.toFixed(1):Number.isInteger(c*1e3)?c.toFixed(3):parseFloat(c.toFixed(2)).toString(),y={currentInput:o,finished:e,finalResults:s,finalTotalTime:i,formatNumber:n,generateQuestion:()=>{const c=Math.random()>.5?"toPercentage":"toFraction",_=Math.floor(Math.random()*19)+2,h=1/_;if(c==="toPercentage"){const w=h*100,S=Math.round(w*10)/10;return{display:`${_}\\1`,answer:S.toString(),type:"toPercentage"}}else{const w=Math.random()>.5;let S="";return w?S=`${n(h*100)}%`:S=parseFloat(h.toFixed(3)).toString(),{display:S,answer:_.toString(),type:"toFraction"}}},isRight:(c,_)=>{if(c.type==="toPercentage"){const h=parseFloat(_),w=parseFloat(c.answer);return isNaN(h)?!1:Math.abs(h-w)<.06}else return parseInt(_)===parseInt(c.answer)},handleComplete:(c,_)=>{s.value=c,i.value=_,e.value=!0},handleInput:(c,_)=>{const h=o.value+c;if(_==="toPercentage"){if(!/^\d{0,2}(\.\d{0,2})?$/.test(h))return}else if(!/^\d{0,2}$/.test(h))return;o.value=h},handleDelete:()=>{o.value=o.value.slice(0,-1)},handleConfirm:async c=>{o.value!==""&&(c(o.value),o.value="")},handleRestart:()=>{e.value=!1,o.value="",s.value=[],i.value=0},VirtualKeypad:be,Summary:Ee,MathDisplay:Ne,BaseTraining:nt};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}}),ot={class:"card w-full bg-base-100 shadow-xl mb-8"},at={class:"card-body items-center text-center py-12"},rt={class:"card-title text-5xl font-bold font-mono flex items-center gap-4"},lt={class:"inline-flex items-center justify-center w-36 px-3 py-1 rounded-lg bg-base-200 border-2 border-primary/50"},it={key:0},ut={key:1,class:"animate-pulse text-base-content/30"},ct={class:"mt-auto w-full"},dt={key:0},mt={key:0};function ft(f,a,o,e,s,i){return e.finished?(u(),A(e.Summary,{key:1,results:e.finalResults,totalTime:e.finalTotalTime,storageKey:o.storageKey,onRestart:e.handleRestart},{question:P(({result:n})=>[j(e.MathDisplay,{value:n.question.display},null,8,["value"])]),userAnswer:P(({result:n})=>[n.question.type==="toPercentage"?(u(),p("span",dt,b(n.userAnswer)+"%",1)):(u(),A(e.MathDisplay,{key:1,value:`${n.userAnswer}\\1`},null,8,["value"]))]),correctAnswer:P(({result:n})=>[n.question.type==="toPercentage"?(u(),p("span",mt,b(n.question.answer)+"%",1)):(u(),A(e.MathDisplay,{key:1,value:`${n.question.answer}\\1`},null,8,["value"]))]),_:1},8,["results","totalTime","storageKey"])):(u(),A(e.BaseTraining,{key:0,type:o.type,storageKey:o.storageKey,numQuestions:o.numQuestions,generateQuestion:e.generateQuestion,isRight:e.isRight,onComplete:e.handleComplete},{description:P(()=>[...a[0]||(a[0]=[t("h2",{class:"card-title text-3xl font-bold mb-6"},"分数与百分比转换",-1),t("div",{class:"text-left w-full mb-8"},[t("div",{class:"bg-base-200 p-5 rounded-2xl"},[t("div",{class:"flex items-center gap-2 mb-4 text-base-content/80"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"stroke-current shrink-0 w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),t("h3",{class:"font-bold text-lg"},"题型说明")]),t("div",{class:"space-y-3"},[t("div",{class:"bg-base-100 p-4 rounded-xl border border-base-300/50 shadow-sm flex flex-col gap-1"},[t("div",{class:"font-bold text-base flex items-center gap-2"},[t("span",{class:"badge badge-primary badge-sm"},"1"),B(" 分数 ➔ 百分比 ")]),t("div",{class:"text-sm opacity-80 pl-7"},[B(" 如 "),t("span",{class:"font-mono font-bold mx-1"},"1/3"),B(" 需输入 "),t("span",{class:"font-mono font-bold mx-1"},"33.3"),t("div",{class:"text-xs text-warning mt-1 font-medium"},"* 至少精确到一位小数")])]),t("div",{class:"bg-base-100 p-4 rounded-xl border border-base-300/50 shadow-sm flex flex-col gap-1"},[t("div",{class:"font-bold text-base flex items-center gap-2"},[t("span",{class:"badge badge-secondary badge-sm"},"2"),B(" 百分比/小数 ➔ 分数 ")]),t("div",{class:"text-sm opacity-80 pl-7"},[B(" 如 "),t("span",{class:"font-mono font-bold mx-1"},"5%"),B(" 需输入 "),t("span",{class:"font-mono font-bold mx-1"},"20"),t("div",{class:"text-xs opacity-60 mt-1"},"(即 1/20 的分母)")])])])])],-1)])]),default:P(({question:n,confirm:l})=>[t("div",ot,[t("div",at,[t("h2",rt,[j(e.MathDisplay,{value:n.display},null,8,["value"]),a[2]||(a[2]=t("span",null,"=",-1)),n.type==="toPercentage"?(u(),p(K,{key:0},[t("span",lt,[e.currentInput?(u(),p("span",it,b(e.currentInput),1)):(u(),p("span",ut,"?"))]),a[1]||(a[1]=t("span",null,"%",-1))],64)):(u(),A(e.MathDisplay,{key:1,value:`${e.currentInput||"?"}\\1`,class:"w-20 px-3 py-1 rounded-lg bg-base-200 border-2 border-primary/50"},null,8,["value"]))])])]),t("div",ct,[j(e.VirtualKeypad,{onInput:d=>e.handleInput(d,n.type),onDelete:e.handleDelete,onConfirm:()=>e.handleConfirm(l)},null,8,["onInput","onConfirm"])])]),_:1},8,["type","storageKey","numQuestions"]))}const ht=E(st,[["render",ft]]);export{ht as default};
