import{_ as S}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{d as F,c as f,o as l,a as e,F as A,r as N,t as v,e as U,f as j,n as I,g as B,h as $,i as k,j as P,m as G,b as _,k as J,l as D,s as V,p as M,q as Q}from"./runtime-core.esm-bundler.DhsM4LcL.js";import{n as W}from"./router.BSJf0dKq.js";const X=F({__name:"VirtualKeypad",emits:["input","delete","confirm"],setup(c,{expose:s,emit:o}){s();const t=o,a=["1","2","3","4","5","6","7","8","9",".","0","\\"],u=d=>{t("input",d)},n=()=>{t("delete")},r=()=>{t("confirm")},i=d=>{a.includes(d.key)?u(d.key):d.key==="Backspace"?n():d.key==="Enter"&&r()};U(()=>{window.addEventListener("keydown",i)}),j(()=>{window.removeEventListener("keydown",i)});const p={emit:t,keys:a,handleInput:u,handleDelete:n,handleConfirm:r,handleKeyboard:i};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}}),Y={class:"grid grid-cols-3 gap-2 p-4 bg-base-100 rounded-t-2xl shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] fixed bottom-0 left-0 right-0 w-full max-w-md mx-auto z-50 pb-8"},Z=["onClick"];function ee(c,s,o,t,a,u){return l(),f("div",Y,[(l(),f(A,null,N(t.keys,n=>e("button",{key:n,onClick:r=>t.handleInput(n),class:"btn btn-lg text-2xl font-bold bg-base-200 hover:bg-base-300 border-none shadow-sm active:scale-95 transition-transform"},v(n==="\\"?"分之":n),9,Z)),64)),e("button",{onClick:t.handleDelete,class:"btn btn-lg text-xl font-bold bg-error/10 text-error hover:bg-error/20 border-none shadow-sm active:scale-95 transition-transform"}," ⌫ "),e("button",{onClick:t.handleConfirm,class:"btn btn-lg text-xl font-bold bg-primary text-primary-content hover:bg-primary-focus border-none shadow-sm col-span-2 active:scale-95 transition-transform"}," 确定 ")])}const te=S(X,[["render",ee]]),ne=F({__name:"Summary",props:{results:{},totalTime:{}},setup(c,{expose:s}){s();const o=c,t=$(()=>o.results.filter(i=>i.isCorrect).length),a=$(()=>o.results.length-t.value),u=$(()=>o.results.length===0?0:Math.round(t.value/o.results.length*100)),r={props:o,correctCount:t,wrongCount:a,accuracy:u,formatTime:i=>{const p=Math.floor(i/6e4).toString().padStart(2,"0"),d=Math.floor(i%6e4/1e3).toString().padStart(2,"0"),y=(i%1e3).toString().padStart(3,"0");return`${p}:${d}.${y}`}};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}}),se={class:"flex flex-col h-dvh gap-6 p-4 w-full max-w-2xl mx-auto"},oe={class:"stats shadow w-full bg-base-100 flex-none"},re={class:"stat place-items-center"},ae={class:"stat-value text-primary"},le={class:"stat place-items-center"},ie={class:"stat-desc"},ue={class:"overflow-y-auto flex-1 bg-base-100 rounded-box shadow"},ce={class:"table table-zebra w-full table-pin-rows"},de={class:"font-mono text-lg"},me={class:"font-mono text-lg text-base-content/70"},fe={class:"font-mono text-sm"};function pe(c,s,o,t,a,u){return l(),f("div",se,[e("div",oe,[e("div",re,[s[0]||(s[0]=e("div",{class:"stat-title"},"总用时",-1)),e("div",ae,v(t.formatTime(o.totalTime)),1)]),e("div",le,[s[1]||(s[1]=e("div",{class:"stat-title"},"正确率",-1)),e("div",{class:I(["stat-value",t.accuracy>=80?"text-success":"text-warning"])},v(t.accuracy)+"% ",3),e("div",ie,v(t.correctCount)+" 正确, "+v(t.wrongCount)+" 错误",1)])]),e("div",ue,[e("table",ce,[s[2]||(s[2]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"问题"),e("th",null,"回答"),e("th",null,"正确答案"),e("th",null,"用时")])],-1)),e("tbody",null,[(l(!0),f(A,null,N(o.results,(n,r)=>(l(),f("tr",{key:r,class:I({"bg-error/10":!n.isCorrect})},[e("th",null,v(r+1),1),e("td",de,[B(c.$slots,"question",{result:n})]),e("td",{class:I(["font-mono text-lg font-bold",n.isCorrect?"text-success":"text-error"])},[B(c.$slots,"userAnswer",{result:n})],2),e("td",me,[B(c.$slots,"correctAnswer",{result:n})]),e("td",fe,[B(c.$slots,"timeSpent",{result:n},()=>[k(v(t.formatTime(n.timeSpent)),1)])])],2))),128))])])]),s[3]||(s[3]=e("div",{class:"flex justify-center mt-4 flex-none"},[e("a",{href:"/",class:"btn btn-primary btn-wide"},"返回首页")],-1))])}const be=S(ne,[["render",pe]]),ve=F({__name:"MathDisplay",props:{value:{}},setup(c,{expose:s}){s();const o=c,t=$(()=>{const u=o.value;if(!u)return[{type:"text",value:""}];const n=/(?<!\\)([\d?|]+\s*\\\s*[\d?|]+)(?!\\)/g,r=[];let i=0,p;for(;(p=n.exec(u))!==null;){p.index>i&&r.push({type:"text",value:u.slice(i,p.index)});const d=p[0].split("\\");r.push({type:"fraction",denominator:d[0].trim(),numerator:d[1].trim()}),i=n.lastIndex}return i<u.length&&r.push({type:"text",value:u.slice(i)}),r}),a={props:o,segments:t};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}}),ge={class:"inline-flex items-center align-middle flex-wrap"},_e={key:0,class:"inline-flex flex-col items-center mx-[0.1em] leading-none",style:{"vertical-align":"middle"}},he={class:"border-b-[0.08em] border-current px-[0.2em] pb-[0.1em] text-[0.75em] leading-none text-center block"},xe={class:"px-[0.2em] pt-[0.1em] text-[0.75em] leading-none text-center block"},ye={key:1,class:"whitespace-pre"};function we(c,s,o,t,a,u){return l(),f("span",ge,[(l(!0),f(A,null,N(t.segments,(n,r)=>(l(),f(A,{key:r},[n.type==="fraction"?(l(),f("span",_e,[e("span",he,v(n.numerator),1),e("span",xe,v(n.denominator),1)])):(l(),f("span",ye,v(n.value),1))],64))),128))])}const ke=S(ve,[["render",we]]),L=()=>{history.state?.index?history.back():W("/",{history:"replace"})},Ce=F({__name:"TopBar",props:{startTime:{},currentQuestion:{},totalQuestions:{}},setup(c,{expose:s}){s();const o=c,t=_("00:00");let a=null;const u=()=>{L()},n=d=>{const y=Math.floor(d/60).toString().padStart(2,"0"),T=Math.floor(d%60).toString().padStart(2,"0");return`${y}:${T}`},r=()=>{a&&clearInterval(a),t.value="00:00",a=window.setInterval(()=>{o.startTime&&(t.value=n((Date.now()-o.startTime)/1e3))},100)},i=()=>{a&&(clearInterval(a),a=null)};J(()=>{o.startTime&&r()}),j(()=>{i()});const p={props:o,time:t,get timerInterval(){return a},set timerInterval(d){a=d},goBack:u,formatTime:n,startTimer:r,stopTimer:i};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}}),De={class:"flex-none flex items-center gap-4"},Be={key:0,class:"text-sm uppercase tracking-widest opacity-50"},Se={class:"font-mono text-xl font-bold text-primary"};function Fe(c,s,o,t,a,u){return l(),f("div",G(c.$attrs,{class:"navbar bg-base-100 shadow-md px-4 min-h-12"}),[e("div",{class:"flex-1"},[e("button",{onClick:t.goBack,class:"btn btn-ghost btn-sm gap-2"},[...s[0]||(s[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})],-1),k(" 返回 ",-1)])])]),e("div",De,[o.totalQuestions?(l(),f("div",Be,v(o.currentQuestion)+" / "+v(o.totalQuestions),1)):P("",!0),e("div",Se,v(t.time),1)])],16)}const Te=S(Ce,[["render",Fe]]),Ee=F({__name:"BaseTraining",props:{numQuestions:{},generateQuestion:{type:Function},isRight:{type:Function},storageKey:{}},emits:["complete"],setup(c,{expose:s,emit:o}){s();const t=c,a=o,u=_(!1),n=V([]),r=_(0),i=_("none"),p=_(0),d=_(0),y=V([]),T=_(null);let h=null;const m=()=>{h=g=>{g.preventDefault(),T.value?.showModal()},document.addEventListener("astro:before-preparation",h)},b=()=>{h&&(document.removeEventListener("astro:before-preparation",h),h=null)},w=()=>{b(),L()},C=()=>{u.value=!0;const g=[];for(let E=0;E<t.numQuestions;E++)g.push(t.generateQuestion());n.value=g,p.value=Date.now(),d.value=Date.now(),r.value=0,m()},x=$(()=>{if(n.value.length!==0)return n.value[r.value]}),O=g=>{if(i.value!=="none"||!x.value)return Promise.resolve();const E=x.value,R=t.isRight(E,g),z=Date.now()-d.value;return y.value.push({question:E,userAnswer:g,isCorrect:R,timeSpent:z}),i.value=R?"correct":"wrong",new Promise(H=>{setTimeout(()=>{i.value="none",H(),r.value<n.value.length-1?(r.value++,d.value=Date.now()):q()},500)})},q=()=>{b();const g=Date.now()-p.value;a("complete",y.value,g)};j(()=>{b()});const K={props:t,emit:a,started:u,questions:n,currentQuestionIndex:r,feedback:i,startTime:p,questionStartTime:d,results:y,confirmModal:T,get navigationHandler(){return h},set navigationHandler(g){h=g},setupNavigationInterception:m,cleanupNavigationInterception:b,performNavigation:w,startTraining:C,currentQuestion:x,handleConfirm:O,finish:q,TopBar:Te};return Object.defineProperty(K,"__isScriptSetup",{enumerable:!1,value:!0}),K}}),Me={class:"flex flex-col items-center w-full flex-1 relative"},Qe={key:0,class:"card w-full bg-base-100 shadow-xl"},Ie={class:"card-body items-center text-center"},$e={key:1,class:"w-full flex flex-col items-center flex-1"},Pe={key:2,class:"absolute inset-0 flex items-center justify-center z-10 pointer-events-none"},Ae={ref:"confirmModal",class:"modal"};function Ne(c,s,o,t,a,u){return l(),f("div",Me,[D(t.TopBar,{startTime:t.startTime,currentQuestion:t.currentQuestionIndex+1,totalQuestions:o.numQuestions,class:"w-full mb-6"},null,8,["startTime","currentQuestion","totalQuestions"]),t.started?P("",!0):(l(),f("div",Qe,[e("div",Ie,[B(c.$slots,"description"),e("div",{class:"card-actions mt-8"},[e("button",{class:"btn btn-primary btn-lg btn-wide",onClick:t.startTraining},"开始训练")])])])),t.started&&t.currentQuestion?(l(),f("div",$e,[B(c.$slots,"default",{question:t.currentQuestion,feedback:t.feedback,confirm:t.handleConfirm})])):P("",!0),t.feedback!=="none"?(l(),f("div",Pe,[e("div",{class:I(["text-9xl font-black drop-shadow-lg transform transition-all scale-150",t.feedback==="correct"?"text-success":"text-error"])},v(t.feedback==="correct"?"✓":"✗"),3)])):P("",!0),e("dialog",Ae,[e("div",{class:"modal-box"},[s[1]||(s[1]=e("h3",{class:"font-bold text-lg"},"提示",-1)),s[2]||(s[2]=e("p",{class:"py-4"},"确定要退出训练吗？当前进度将丢失。",-1)),e("div",{class:"modal-action"},[e("form",{method:"dialog"},[s[0]||(s[0]=e("button",{class:"btn"},"取消",-1)),e("button",{class:"btn btn-error ml-2",onClick:t.performNavigation},"确定退出")])])]),s[3]||(s[3]=e("form",{method:"dialog",class:"modal-backdrop"},[e("button",null,"close")],-1))],512)])}const je=S(Ee,[["render",Ne]]),qe=F({__name:"FractionPercentage",props:{numQuestions:{},storageKey:{}},setup(c,{expose:s}){s();const o=_(""),t=_(!1),a=_([]),u=_(0),n=m=>Number.isInteger(m)?m.toString():Number.isInteger(m*10)?m.toFixed(1):parseFloat(m.toFixed(2)).toString(),h={currentInput:o,finished:t,finalResults:a,finalTotalTime:u,formatNumber:n,generateQuestion:()=>{const m=Math.random()>.5?"toPercentage":"toFraction",b=Math.floor(Math.random()*19)+2,w=1/b;if(m==="toPercentage"){const C=w*100,x=Math.round(C*10)/10;return{display:`${b}\\1`,answer:x.toString(),type:"toPercentage"}}else{const C=Math.random()>.5;let x="";return C?x=`${n(w*100)}%`:x=parseFloat(w.toFixed(3)).toString(),{display:x,answer:b.toString(),type:"toFraction"}}},isRight:(m,b)=>{if(m.type==="toPercentage"){const w=parseFloat(b),C=parseFloat(m.answer);return isNaN(w)?!1:Math.abs(w-C)<.06}else return parseInt(b)===parseInt(m.answer)},handleComplete:(m,b)=>{a.value=m,u.value=b,t.value=!0},handleInput:(m,b)=>{b==="none"&&(o.value+=m)},handleDelete:m=>{m==="none"&&(o.value=o.value.slice(0,-1))},handleConfirm:async(m,b)=>{o.value===""||b!=="none"||(await m(o.value),o.value="")},VirtualKeypad:te,Summary:be,MathDisplay:ke,BaseTraining:je};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}}),Ke={class:"card w-full bg-base-100 shadow-xl mb-8"},Re={class:"card-body items-center text-center py-12"},Ve={class:"card-title text-5xl font-bold font-mono flex items-center gap-4"},Le={key:0},Oe={key:1},ze={class:"w-full px-4 mb-4"},He={key:0,class:"animate-pulse text-base-content/20"},Ue={class:"mt-auto w-full"},Ge={key:0},Je={key:0};function We(c,s,o,t,a,u){return t.finished?(l(),M(t.Summary,{key:1,results:t.finalResults,totalTime:t.finalTotalTime},{question:Q(({result:n})=>[D(t.MathDisplay,{value:n.question.display},null,8,["value"])]),userAnswer:Q(({result:n})=>[n.question.type==="toPercentage"?(l(),f("span",Ge,v(n.userAnswer)+"%",1)):(l(),M(t.MathDisplay,{key:1,value:`${n.userAnswer}\\1`},null,8,["value"]))]),correctAnswer:Q(({result:n})=>[n.question.type==="toPercentage"?(l(),f("span",Je,v(n.question.answer)+"%",1)):(l(),M(t.MathDisplay,{key:1,value:`${n.question.answer}\\1`},null,8,["value"]))]),_:1},8,["results","totalTime"])):(l(),M(t.BaseTraining,{key:0,storageKey:o.storageKey,numQuestions:o.numQuestions,generateQuestion:t.generateQuestion,isRight:t.isRight,onComplete:t.handleComplete},{description:Q(()=>[...s[0]||(s[0]=[e("h2",{class:"card-title text-3xl font-bold mb-6"},"分数与百分比转换",-1),e("div",{class:"text-left w-full mb-8"},[e("div",{class:"bg-base-200 p-5 rounded-2xl"},[e("div",{class:"flex items-center gap-2 mb-4 text-base-content/80"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"stroke-current shrink-0 w-6 h-6"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("h3",{class:"font-bold text-lg"},"题型说明")]),e("div",{class:"space-y-3"},[e("div",{class:"bg-base-100 p-4 rounded-xl border border-base-300/50 shadow-sm flex flex-col gap-1"},[e("div",{class:"font-bold text-base flex items-center gap-2"},[e("span",{class:"badge badge-primary badge-sm"},"1"),k(" 分数 ➔ 百分比 ")]),e("div",{class:"text-sm opacity-80 pl-7"},[k(" 如 "),e("span",{class:"font-mono font-bold mx-1"},"1/3"),k(" 需输入 "),e("span",{class:"font-mono font-bold mx-1"},"33.3"),e("div",{class:"text-xs text-warning mt-1 font-medium"},"* 至少精确到一位小数")])]),e("div",{class:"bg-base-100 p-4 rounded-xl border border-base-300/50 shadow-sm flex flex-col gap-1"},[e("div",{class:"font-bold text-base flex items-center gap-2"},[e("span",{class:"badge badge-secondary badge-sm"},"2"),k(" 百分比/小数 ➔ 分数 ")]),e("div",{class:"text-sm opacity-80 pl-7"},[k(" 如 "),e("span",{class:"font-mono font-bold mx-1"},"5%"),k(" 需输入 "),e("span",{class:"font-mono font-bold mx-1"},"20"),e("div",{class:"text-xs opacity-60 mt-1"},"(即 1/20 的分母)")])])])])],-1)])]),default:Q(({question:n,feedback:r,confirm:i})=>[e("div",Ke,[e("div",Re,[e("h2",Ve,[D(t.MathDisplay,{value:n.display},null,8,["value"]),s[1]||(s[1]=e("span",null,"=",-1)),n.type==="toPercentage"?(l(),f("span",Le,"? %")):(l(),f("span",Oe,[D(t.MathDisplay,{value:"? \\ 1"})]))])])]),e("div",ze,[e("div",{class:I(["h-16 rounded-xl flex items-center justify-center text-3xl font-bold font-mono bg-base-200 border-2 transition-colors",{"border-base-300":r==="none","border-success bg-success/10 text-success":r==="correct","border-error bg-error/10 text-error":r==="wrong"}])},[n.type==="toPercentage"?(l(),f(A,{key:0},[D(t.MathDisplay,{value:t.currentInput},null,8,["value"]),t.currentInput?P("",!0):(l(),f("span",He,"|")),s[2]||(s[2]=e("span",{class:"text-base-content/50 ml-1"},"%",-1))],64)):(l(),M(t.MathDisplay,{key:1,value:`${t.currentInput||"|"}\\1`},null,8,["value"]))],2)]),e("div",Ue,[D(t.VirtualKeypad,{onInput:p=>t.handleInput(p,r),onDelete:()=>t.handleDelete(r),onConfirm:()=>t.handleConfirm(i,r)},null,8,["onInput","onDelete","onConfirm"])])]),_:1},8,["storageKey","numQuestions"]))}const et=S(qe,[["render",We]]);export{et as default};
