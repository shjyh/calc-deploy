import{_ as A,n as K,a as E,s as st,b as nt,c as ot,r as rt}from"./_plugin-vue_export-helper.C1BGYAOa.js";import{d as F,c as f,l as v,b as e,F as z,q as G,o as U,x as q,e as _,g as D,k as T,z as k,f as H,u as $,A as at,r as x,B as it,p as lt,y as ut,s as O,C as ct}from"./runtime-core.esm-bundler.DsaXcS8p.js";/* empty css                        */const dt=F({__name:"VirtualKeypad",emits:["input","delete","confirm"],setup(c,{expose:o,emit:a}){o();const t=a,s=["1","2","3","4","5","6","7","8","9",".","0","\\"],d=i=>{t("input",i)},r=()=>{t("delete")},l=()=>{t("confirm")},m=i=>{s.includes(i.key)?d(i.key):i.key==="Backspace"?r():i.key==="Enter"&&l()};U(()=>{window.addEventListener("keydown",m)}),q(()=>{window.removeEventListener("keydown",m)});const g={emit:t,keys:s,handleInput:d,handleDelete:r,handleConfirm:l,handleKeyboard:m};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}}),mt={class:"grid grid-cols-3 gap-2 p-4 bg-base-100 rounded-t-2xl shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] fixed bottom-0 left-0 right-0 w-full max-w-md mx-auto z-50 pb-8"},ft=["onClick"];function vt(c,o,a,t,s,d){return v(),f("div",mt,[(v(),f(z,null,G(t.keys,r=>e("button",{key:r,onClick:l=>t.handleInput(r),class:"btn btn-lg font-bold bg-base-200 hover:bg-base-300 active:bg-base-300 border-none shadow-sm active:scale-95 transition-transform"},_(r==="\\"?"分之":r),9,ft)),64)),e("button",{onClick:t.handleDelete,class:"btn btn-lg btn-soft btn-secondary text-xl font-bold border-none shadow-sm active:scale-95 transition-transform"}," ⌫ "),e("button",{onClick:t.handleConfirm,class:"btn btn-lg btn-soft btn-primary text-xl font-bold border-none shadow-sm col-span-2 active:scale-95 transition-transform"}," 确定 ")])}const Ut=A(dt,[["render",vt]]),gt=F({__name:"Summary",props:{results:{},totalTime:{},storageKey:{}},emits:["restart"],setup(c,{expose:o,emit:a}){o();const t=c,s=a,d=T(()=>t.results.filter(u=>u.isCorrect).length),r=T(()=>t.results.length-d.value),l=T(()=>t.results.length===0?0:Math.round(d.value/t.results.length*100)),b={props:t,emit:s,correctCount:d,wrongCount:r,accuracy:l,formatTime:u=>{const B=Math.floor(u/6e4).toString().padStart(2,"0"),h=Math.floor(u%6e4/1e3).toString().padStart(2,"0"),C=(u%1e3).toString().padStart(3,"0");return`${B}:${h}.${C}`},goBack:()=>{K()},handleRestart:()=>{E(t.storageKey),s("restart")}};return Object.defineProperty(b,"__isScriptSetup",{enumerable:!1,value:!0}),b}}),bt={class:"flex flex-col h-dvh gap-6 p-4 w-full max-w-2xl mx-auto"},pt={class:"stats shadow w-full bg-base-100 flex-none"},_t={class:"stat place-items-center"},ht={class:"stat-value text-primary"},wt={class:"stat place-items-center"},xt={class:"stat-desc"},yt={class:"overflow-y-auto flex-1 bg-base-100 rounded-box shadow"},kt={class:"table table-zebra w-full table-pin-rows"},Tt={class:"font-mono text-lg"},Ct={class:"font-mono text-lg text-base-content/70"},Bt={class:"font-mono text-sm"};function St(c,o,a,t,s,d){return v(),f("div",bt,[e("div",pt,[e("div",_t,[o[0]||(o[0]=e("div",{class:"stat-title"},"总用时",-1)),e("div",ht,_(t.formatTime(a.totalTime)),1)]),e("div",wt,[o[1]||(o[1]=e("div",{class:"stat-title"},"正确率",-1)),e("div",{class:D(["stat-value",t.accuracy>=80?"text-success":"text-warning"])},_(t.accuracy)+"% ",3),e("div",xt,_(t.correctCount)+" 正确, "+_(t.wrongCount)+" 错误",1)])]),e("div",yt,[e("table",kt,[o[2]||(o[2]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"问题"),e("th",null,"回答"),e("th",null,"正确答案"),e("th",null,"用时")])],-1)),e("tbody",null,[(v(!0),f(z,null,G(a.results,(r,l)=>(v(),f("tr",{key:l,class:D({"bg-error/10":!r.isCorrect})},[e("th",null,_(l+1),1),e("td",Tt,[k(c.$slots,"question",{result:r})]),e("td",{class:D(["font-mono text-lg font-bold",r.isCorrect?"text-success":"text-error"])},[k(c.$slots,"userAnswer",{result:r})],2),e("td",Ct,[k(c.$slots,"correctAnswer",{result:r})]),e("td",Bt,[k(c.$slots,"timeSpent",{result:r},()=>[H(_(t.formatTime(r.timeSpent)),1)])])],2))),128))])])]),e("div",{class:"flex justify-center gap-4 mt-4 flex-none"},[e("button",{onClick:t.goBack,class:"btn btn-outline flex-1 max-w-40"},"返回"),e("button",{onClick:t.handleRestart,class:"btn btn-primary flex-1 max-w-40"},"再来一次")])])}const Ht=A(gt,[["render",St]]),Qt=F({__name:"TopBar",props:{startTime:{},currentQuestion:{},totalQuestions:{}},setup(c,{expose:o}){o();const a=c,t=x("00:00");let s=null;const d=()=>{K()},r=i=>{const b=Math.floor(i/60).toString().padStart(2,"0"),u=Math.floor(i%60).toString().padStart(2,"0");return`${b}:${u}`},l=()=>{s&&clearInterval(s),t.value="00:00",s=window.setInterval(()=>{a.startTime&&(t.value=r((Date.now()-a.startTime)/1e3))},100)},m=()=>{s&&(clearInterval(s),s=null)};it(()=>{a.startTime&&(a.startTime===-1?m():l())}),q(()=>{m()});const g={props:a,time:t,get timerInterval(){return s},set timerInterval(i){s=i},goBack:d,formatTime:r,startTimer:l,stopTimer:m};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}}),Et={class:"flex-none flex items-center gap-4"},Dt={key:0,class:"text-sm uppercase tracking-widest opacity-50"},At={class:"font-mono text-xl font-bold text-primary"};function Ft(c,o,a,t,s,d){return v(),f("div",at(c.$attrs,{class:"navbar bg-base-100 shadow-md px-4 min-h-12"}),[e("div",{class:"flex-1"},[e("button",{onClick:t.goBack,class:"btn btn-ghost btn-sm gap-2"},[...o[0]||(o[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})],-1),H(" 返回 ",-1)])])]),e("div",Et,[a.totalQuestions?(v(),f("div",Dt,_(a.currentQuestion)+" / "+_(a.totalQuestions),1)):$("",!0),e("div",At,_(t.time),1)])],16)}const It=A(Qt,[["render",Ft]]),V=1800*1e3,L="flag:nav-from-training",Mt=F({__name:"BaseTraining",props:{type:{},numQuestions:{},generateQuestion:{type:Function},isRight:{type:Function},storageKey:{}},emits:["complete"],setup(c,{expose:o,emit:a}){o();const t={correct:"#22c55e",wrong:"#ef4444",pending:"#ffffff"},s=c,d=a,r=x(!1),l=O([]),m=x(0),g=x("none"),i=x(0),b=x(0),u=O([]),B=x(null);let h=null;const C=()=>{st(s.storageKey,{questions:l.value,startTime:i.value,questionStartTime:b.value,results:u.value,savedAt:Date.now(),numQuestions:s.numQuestions})},N=()=>{const n=nt(s.storageKey);return n?Date.now()-n.savedAt>V?(E(s.storageKey),!1):n.numQuestions!==s.numQuestions?(E(s.storageKey),!1):(l.value=n.questions,m.value=Math.min(n.results.length,n.questions.length-1),i.value=n.startTime,b.value=n.questionStartTime,u.value=n.results,r.value=!0,n):!1},I=()=>{h=n=>{n.preventDefault(),B.value?.showModal()},document.addEventListener("astro:before-preparation",h)},S=()=>{h&&(document.removeEventListener("astro:before-preparation",h),h=null)},W=()=>{S(),E(s.storageKey),K()},X=()=>{r.value=!0;const n=[];for(let p=0;p<s.numQuestions;p++)n.push(s.generateQuestion());l.value=n,i.value=Date.now(),b.value=Date.now(),m.value=0,C(),I()},M=T(()=>{if(l.value.length!==0)return l.value[m.value]}),Y=n=>{if(g.value!=="none"||!M.value)return Promise.resolve();const p=M.value,y=s.isRight(p,n),w=Date.now()-b.value;u.value.push({question:p,userAnswer:n,isCorrect:y,timeSpent:w}),ct(u),g.value=y?"correct":"wrong",C(),m.value<l.value.length-1?(m.value++,b.value=Date.now()):P(),setTimeout(()=>{g.value="none"},300)},P=()=>{S();const n=Date.now()-i.value;if(s.storageKey){const p=u.value.filter(w=>w.isCorrect).length,y={timestamp:i.value,numQuestions:s.numQuestions,correctCount:p,avgTimePerQuestion:Math.round(n/s.numQuestions),totalTime:n};ot(s.storageKey,y)}i.value=-1,setTimeout(()=>{d("complete",u.value,n)},500)};U(()=>{const n=N();n&&(u.value.length===s.numQuestions?d("complete",u.value,n.savedAt-n.startTime):I())}),q(()=>{S()});const J=T(()=>rt(`/statistics/${s.type}`)),Z=()=>{sessionStorage.setItem(L,"1")},tt=T(()=>{const n=s.numQuestions;if(n===0)return"linear-gradient(to right, white 100%)";const p=[],y=100/n;for(let w=0;w<n;w++){const j=u.value[w];let Q;j===void 0?Q=t.pending:j.isCorrect?Q=t.correct:Q=t.wrong;const et=(w+.5)*y;p.push(`${Q} ${et}%`)}return`linear-gradient(to right, ${p.join(", ")})`}),R={COLORS:t,props:s,emit:d,STORAGE_MAX_AGE:V,started:r,questions:l,currentQuestionIndex:m,feedback:g,startTime:i,questionStartTime:b,results:u,confirmModal:B,get navigationHandler(){return h},set navigationHandler(n){h=n},saveProgress:C,loadProgress:N,setupNavigationInterception:I,cleanupNavigationInterception:S,performNavigation:W,startTraining:X,currentQuestion:M,handleConfirm:Y,finish:P,NAV_FROM_TRAINING_KEY:L,statisticsUrl:J,goToStatistics:Z,progressGradient:tt,TopBar:It};return Object.defineProperty(R,"__isScriptSetup",{enumerable:!1,value:!0}),R}}),$t={class:"flex flex-col items-center w-full overflow-x-hidden flex-1 relative"},Kt={key:1,class:"mb-6"},qt={key:2,class:"card w-full bg-base-100 shadow-xl"},Nt={class:"card-body items-center text-center"},Pt={class:"card-actions mt-8 w-full justify-between"},Rt=["href"],jt={key:3,class:"w-full flex flex-col items-center flex-1"},Ot={ref:"confirmModal",class:"modal"};function Vt(c,o,a,t,s,d){return v(),f("div",$t,[lt(t.TopBar,{startTime:t.startTime,currentQuestion:t.currentQuestionIndex+1,totalQuestions:a.numQuestions,class:"w-full"},null,8,["startTime","currentQuestion","totalQuestions"]),t.started?(v(),f("div",{key:0,class:D(["progress-bar w-full h-2 mb-4",{"feedback-correct":t.feedback==="correct","feedback-wrong":t.feedback==="wrong"}]),style:ut({background:t.progressGradient})},null,6)):(v(),f("div",Kt)),t.started?$("",!0):(v(),f("div",qt,[e("div",Nt,[k(c.$slots,"description",{},void 0,!0),e("div",Pt,[e("a",{href:t.statisticsUrl,class:"btn btn-link",onClick:t.goToStatistics},"历史统计",8,Rt),e("button",{class:"btn btn-primary btn-lg",onClick:t.startTraining},"开始训练")])])])),t.started&&t.currentQuestion?(v(),f("div",jt,[k(c.$slots,"default",{question:t.currentQuestion,feedback:t.feedback,confirm:t.handleConfirm},void 0,!0)])):$("",!0),e("dialog",Ot,[e("div",{class:"modal-box"},[o[1]||(o[1]=e("h3",{class:"font-bold text-lg"},"提示",-1)),o[2]||(o[2]=e("p",{class:"py-4"},"确定要退出训练吗？当前进度将丢失。",-1)),e("div",{class:"modal-action"},[e("form",{method:"dialog"},[o[0]||(o[0]=e("button",{class:"btn"},"取消",-1)),e("button",{class:"btn btn-error ml-2",onClick:t.performNavigation},"确定退出")])])]),o[3]||(o[3]=e("form",{method:"dialog",class:"modal-backdrop"},[e("button",null,"close")],-1))],512)])}const Wt=A(Mt,[["render",Vt],["__scopeId","data-v-e4e72e52"]]);export{Wt as B,Ht as S,Ut as V};
