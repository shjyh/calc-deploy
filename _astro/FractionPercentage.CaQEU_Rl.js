import{_ as Q}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{d as I,c as m,o as i,a as t,F as P,r as O,t as h,e as W,f as L,n as N,g as F,h as E,i as C,j as q,m as te,b as w,k as ne,l as T,p as se,s as J,q as oe,u as K,v as A}from"./runtime-core.esm-bundler.BcvP7tK9.js";import{n as ae}from"./router.BSJf0dKq.js";const re=I({__name:"VirtualKeypad",emits:["input","delete","confirm"],setup(f,{expose:o,emit:a}){o();const e=a,s=["1","2","3","4","5","6","7","8","9",".","0","\\"],l=u=>{e("input",u)},n=()=>{e("delete")},r=()=>{e("confirm")},p=u=>{s.includes(u.key)?l(u.key):u.key==="Backspace"?n():u.key==="Enter"&&r()};W(()=>{window.addEventListener("keydown",p)}),L(()=>{window.removeEventListener("keydown",p)});const b={emit:e,keys:s,handleInput:l,handleDelete:n,handleConfirm:r,handleKeyboard:p};return Object.defineProperty(b,"__isScriptSetup",{enumerable:!1,value:!0}),b}}),le={class:"grid grid-cols-3 gap-2 p-4 bg-base-100 rounded-t-2xl shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] fixed bottom-0 left-0 right-0 w-full max-w-md mx-auto z-50 pb-8"},ie=["onClick"];function ce(f,o,a,e,s,l){return i(),m("div",le,[(i(),m(P,null,O(e.keys,n=>t("button",{key:n,onClick:r=>e.handleInput(n),class:"btn btn-lg font-bold bg-base-200 hover:bg-base-300 active:bg-base-300 border-none shadow-sm active:scale-95 transition-transform"},h(n==="\\"?"分之":n),9,ie)),64)),t("button",{onClick:e.handleDelete,class:"btn btn-lg btn-soft btn-secondary text-xl font-bold border-none shadow-sm active:scale-95 transition-transform"}," ⌫ "),t("button",{onClick:e.handleConfirm,class:"btn btn-lg btn-soft btn-primary text-xl font-bold border-none shadow-sm col-span-2 active:scale-95 transition-transform"}," 确定 ")])}const ue=Q(re,[["render",ce]]),V=()=>{history.state?.index?history.back():ae("/calc-deploy",{history:"replace"})},de=I({__name:"Summary",props:{results:{},totalTime:{},storageKey:{}},emits:["restart"],setup(f,{expose:o,emit:a}){o();const e=f,s=a,l=E(()=>e.results.filter(v=>v.isCorrect).length),n=E(()=>e.results.length-l.value),r=E(()=>e.results.length===0?0:Math.round(l.value/e.results.length*100)),_={props:e,emit:s,correctCount:l,wrongCount:n,accuracy:r,formatTime:v=>{const M=Math.floor(v/6e4).toString().padStart(2,"0"),x=Math.floor(v%6e4/1e3).toString().padStart(2,"0"),d=(v%1e3).toString().padStart(3,"0");return`${M}:${x}.${d}`},goBack:()=>{V()},handleRestart:()=>{e.storageKey&&localStorage.removeItem(e.storageKey),s("restart")}};return Object.defineProperty(_,"__isScriptSetup",{enumerable:!1,value:!0}),_}}),me={class:"flex flex-col h-dvh gap-6 p-4 w-full max-w-2xl mx-auto"},fe={class:"stats shadow w-full bg-base-100 flex-none"},pe={class:"stat place-items-center"},ge={class:"stat-value text-primary"},ve={class:"stat place-items-center"},be={class:"stat-desc"},he={class:"overflow-y-auto flex-1 bg-base-100 rounded-box shadow"},_e={class:"table table-zebra w-full table-pin-rows"},xe={class:"font-mono text-lg"},ye={class:"font-mono text-lg text-base-content/70"},we={class:"font-mono text-sm"};function ke(f,o,a,e,s,l){return i(),m("div",me,[t("div",fe,[t("div",pe,[o[0]||(o[0]=t("div",{class:"stat-title"},"总用时",-1)),t("div",ge,h(e.formatTime(a.totalTime)),1)]),t("div",ve,[o[1]||(o[1]=t("div",{class:"stat-title"},"正确率",-1)),t("div",{class:N(["stat-value",e.accuracy>=80?"text-success":"text-warning"])},h(e.accuracy)+"% ",3),t("div",be,h(e.correctCount)+" 正确, "+h(e.wrongCount)+" 错误",1)])]),t("div",he,[t("table",_e,[o[2]||(o[2]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"问题"),t("th",null,"回答"),t("th",null,"正确答案"),t("th",null,"用时")])],-1)),t("tbody",null,[(i(!0),m(P,null,O(a.results,(n,r)=>(i(),m("tr",{key:r,class:N({"bg-error/10":!n.isCorrect})},[t("th",null,h(r+1),1),t("td",xe,[F(f.$slots,"question",{result:n})]),t("td",{class:N(["font-mono text-lg font-bold",n.isCorrect?"text-success":"text-error"])},[F(f.$slots,"userAnswer",{result:n})],2),t("td",ye,[F(f.$slots,"correctAnswer",{result:n})]),t("td",we,[F(f.$slots,"timeSpent",{result:n},()=>[C(h(e.formatTime(n.timeSpent)),1)])])],2))),128))])])]),t("div",{class:"flex justify-center gap-4 mt-4 flex-none"},[t("button",{onClick:e.goBack,class:"btn btn-outline flex-1 max-w-40"},"返回"),t("button",{onClick:e.handleRestart,class:"btn btn-primary flex-1 max-w-40"},"再来一次")])])}const Se=Q(de,[["render",ke]]),Ce=I({__name:"MathDisplay",props:{value:{}},setup(f,{expose:o}){o();const a=f,e=E(()=>{const l=a.value;if(!l)return[{type:"text",value:""}];const n=/(?<!\\)([\d?|]+\s*\\\s*[\d?|]+)(?!\\)/g,r=[];let p=0,b;for(;(b=n.exec(l))!==null;){b.index>p&&r.push({type:"text",value:l.slice(p,b.index)});const u=b[0].split("\\");r.push({type:"fraction",denominator:u[0].trim(),numerator:u[1].trim()}),p=n.lastIndex}return p<l.length&&r.push({type:"text",value:l.slice(p)}),r}),s={props:a,segments:e};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}}),Be={class:"inline-flex items-center align-middle flex-wrap"},De={key:0,class:"inline-flex flex-col items-center mx-[0.1em] leading-none",style:{"vertical-align":"middle"}},Te={class:"border-b-[0.08em] border-current px-[0.2em] pb-[0.1em] text-[0.75em] leading-none text-center block"},Fe={class:"px-[0.2em] pt-[0.1em] text-[0.75em] leading-none text-center block"},Ee={key:1,class:"whitespace-pre"};function Qe(f,o,a,e,s,l){return i(),m("span",Be,[(i(!0),m(P,null,O(e.segments,(n,r)=>(i(),m(P,{key:r},[n.type==="fraction"?(i(),m("span",De,[t("span",Te,h(n.numerator),1),t("span",Fe,h(n.denominator),1)])):(i(),m("span",Ee,h(n.value),1))],64))),128))])}const Ie=Q(Ce,[["render",Qe]]),Me=I({__name:"TopBar",props:{startTime:{},currentQuestion:{},totalQuestions:{}},setup(f,{expose:o}){o();const a=f,e=w("00:00");let s=null;const l=()=>{V()},n=u=>{const _=Math.floor(u/60).toString().padStart(2,"0"),v=Math.floor(u%60).toString().padStart(2,"0");return`${_}:${v}`},r=()=>{s&&clearInterval(s),e.value="00:00",s=window.setInterval(()=>{a.startTime&&(e.value=n((Date.now()-a.startTime)/1e3))},100)},p=()=>{s&&(clearInterval(s),s=null)};ne(()=>{a.startTime&&(a.startTime===-1?p():r())}),L(()=>{p()});const b={props:a,time:e,get timerInterval(){return s},set timerInterval(u){s=u},goBack:l,formatTime:n,startTimer:r,stopTimer:p};return Object.defineProperty(b,"__isScriptSetup",{enumerable:!1,value:!0}),b}}),Ke={class:"flex-none flex items-center gap-4"},Ae={key:0,class:"text-sm uppercase tracking-widest opacity-50"},Pe={class:"font-mono text-xl font-bold text-primary"};function $e(f,o,a,e,s,l){return i(),m("div",te(f.$attrs,{class:"navbar bg-base-100 shadow-md px-4 min-h-12"}),[t("div",{class:"flex-1"},[t("button",{onClick:e.goBack,class:"btn btn-ghost btn-sm gap-2"},[...o[0]||(o[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})],-1),C(" 返回 ",-1)])])]),t("div",Ke,[a.totalQuestions?(i(),m("div",Ae,h(a.currentQuestion)+" / "+h(a.totalQuestions),1)):q("",!0),t("div",Pe,h(e.time),1)])],16)}const Re=Q(Me,[["render",$e]]),U=1800*1e3,Ne=I({__name:"BaseTraining",props:{numQuestions:{},generateQuestion:{type:Function},isRight:{type:Function},storageKey:{}},emits:["complete"],setup(f,{expose:o,emit:a}){o();const e={correct:"#22c55e",wrong:"#ef4444",pending:"#ffffff"},s=f,l=a,n=w(!1),r=J([]),p=w(0),b=w("none"),u=w(0),_=w(0),v=J([]),M=w(null);let x=null;const d=()=>{if(!s.storageKey)return;const c={questions:r.value,startTime:u.value,questionStartTime:_.value,results:v.value,savedAt:Date.now(),numQuestions:s.numQuestions};try{localStorage.setItem(s.storageKey,JSON.stringify(c))}catch(g){console.warn("Failed to save progress:",g)}},y=()=>{if(!s.storageKey)return!1;try{const c=localStorage.getItem(s.storageKey);if(!c)return!1;const g=JSON.parse(c);return Date.now()-g.savedAt>U||g.numQuestions!==s.numQuestions?(localStorage.removeItem(s.storageKey),!1):(r.value=g.questions,p.value=Math.min(g.results.length,g.questions.length-1),u.value=g.startTime,_.value=g.questionStartTime,v.value=g.results,n.value=!0,g)}catch(c){return console.warn("Failed to load progress:",c),!1}},k=()=>{x=c=>{c.preventDefault(),M.value?.showModal()},document.addEventListener("astro:before-preparation",x)},S=()=>{x&&(document.removeEventListener("astro:before-preparation",x),x=null)},B=()=>{S(),s.storageKey&&localStorage.removeItem(s.storageKey),V()},X=()=>{n.value=!0;const c=[];for(let g=0;g<s.numQuestions;g++)c.push(s.generateQuestion());r.value=c,u.value=Date.now(),_.value=Date.now(),p.value=0,d(),k()},j=E(()=>{if(r.value.length!==0)return r.value[p.value]}),Y=c=>{if(b.value!=="none"||!j.value)return Promise.resolve();const g=j.value,$=s.isRight(g,c),D=Date.now()-_.value;v.value.push({question:g,userAnswer:c,isCorrect:$,timeSpent:D}),oe(v),b.value=$?"correct":"wrong",d(),p.value<r.value.length-1?(p.value++,_.value=Date.now()):z(),setTimeout(()=>{b.value="none"},300)},z=()=>{S();const c=Date.now()-u.value;u.value=-1,setTimeout(()=>{l("complete",v.value,c)},500)};W(()=>{const c=y();c&&(v.value.length===s.numQuestions?l("complete",v.value,c.savedAt-c.startTime):k())}),L(()=>{S()});const Z=E(()=>{const c=s.numQuestions;if(c===0)return"linear-gradient(to right, white 100%)";const g=[],$=100/c;for(let D=0;D<c;D++){const H=v.value[D];let R;H===void 0?R=e.pending:H.isCorrect?R=e.correct:R=e.wrong;const ee=(D+.5)*$;g.push(`${R} ${ee}%`)}return`linear-gradient(to right, ${g.join(", ")})`}),G={COLORS:e,props:s,emit:l,STORAGE_MAX_AGE:U,started:n,questions:r,currentQuestionIndex:p,feedback:b,startTime:u,questionStartTime:_,results:v,confirmModal:M,get navigationHandler(){return x},set navigationHandler(c){x=c},saveProgress:d,loadProgress:y,setupNavigationInterception:k,cleanupNavigationInterception:S,performNavigation:B,startTraining:X,currentQuestion:j,handleConfirm:Y,finish:z,progressGradient:Z,TopBar:Re};return Object.defineProperty(G,"__isScriptSetup",{enumerable:!1,value:!0}),G}}),qe={class:"flex flex-col items-center w-full overflow-x-hidden flex-1 relative"},je={key:1,class:"mb-6"},Oe={key:2,class:"card w-full bg-base-100 shadow-xl"},Le={class:"card-body items-center text-center"},Ve={key:3,class:"w-full flex flex-col items-center flex-1"},ze={ref:"confirmModal",class:"modal"};function Ge(f,o,a,e,s,l){return i(),m("div",qe,[T(e.TopBar,{startTime:e.startTime,currentQuestion:e.currentQuestionIndex+1,totalQuestions:a.numQuestions,class:"w-full"},null,8,["startTime","currentQuestion","totalQuestions"]),e.started?(i(),m("div",{key:0,class:N(["progress-bar w-full h-2 mb-4",{"feedback-correct":e.feedback==="correct","feedback-wrong":e.feedback==="wrong"}]),style:se({background:e.progressGradient})},null,6)):(i(),m("div",je)),e.started?q("",!0):(i(),m("div",Oe,[t("div",Le,[F(f.$slots,"description",{},void 0,!0),t("div",{class:"card-actions mt-8"},[t("button",{class:"btn btn-primary btn-lg btn-wide",onClick:e.startTraining},"开始训练")])])])),e.started&&e.currentQuestion?(i(),m("div",Ve,[F(f.$slots,"default",{question:e.currentQuestion,feedback:e.feedback,confirm:e.handleConfirm},void 0,!0)])):q("",!0),t("dialog",ze,[t("div",{class:"modal-box"},[o[1]||(o[1]=t("h3",{class:"font-bold text-lg"},"提示",-1)),o[2]||(o[2]=t("p",{class:"py-4"},"确定要退出训练吗？当前进度将丢失。",-1)),t("div",{class:"modal-action"},[t("form",{method:"dialog"},[o[0]||(o[0]=t("button",{class:"btn"},"取消",-1)),t("button",{class:"btn btn-error ml-2",onClick:e.performNavigation},"确定退出")])])]),o[3]||(o[3]=t("form",{method:"dialog",class:"modal-backdrop"},[t("button",null,"close")],-1))],512)])}const He=Q(Ne,[["render",Ge],["__scopeId","data-v-069b5b2c"]]),Je=I({__name:"FractionPercentage",props:{numQuestions:{},storageKey:{}},setup(f,{expose:o}){o();const a=w(""),e=w(!1),s=w([]),l=w(0),n=d=>Number.isInteger(d)?d.toString():Number.isInteger(d*10)?d.toFixed(1):parseFloat(d.toFixed(2)).toString(),x={currentInput:a,finished:e,finalResults:s,finalTotalTime:l,formatNumber:n,generateQuestion:()=>{const d=Math.random()>.5?"toPercentage":"toFraction",y=Math.floor(Math.random()*19)+2,k=1/y;if(d==="toPercentage"){const S=k*100,B=Math.round(S*10)/10;return{display:`${y}\\1`,answer:B.toString(),type:"toPercentage"}}else{const S=Math.random()>.5;let B="";return S?B=`${n(k*100)}%`:B=parseFloat(k.toFixed(3)).toString(),{display:B,answer:y.toString(),type:"toFraction"}}},isRight:(d,y)=>{if(d.type==="toPercentage"){const k=parseFloat(y),S=parseFloat(d.answer);return isNaN(k)?!1:Math.abs(k-S)<.06}else return parseInt(y)===parseInt(d.answer)},handleComplete:(d,y)=>{s.value=d,l.value=y,e.value=!0},handleInput:d=>{a.value+=d},handleDelete:()=>{a.value=a.value.slice(0,-1)},handleConfirm:async d=>{a.value!==""&&(d(a.value),a.value="")},handleRestart:()=>{e.value=!1,a.value="",s.value=[],l.value=0},VirtualKeypad:ue,Summary:Se,MathDisplay:Ie,BaseTraining:He};return Object.defineProperty(x,"__isScriptSetup",{enumerable:!1,value:!0}),x}}),Ue={class:"card w-full bg-base-100 shadow-xl mb-8"},We={class:"card-body items-center text-center py-12"},Xe={class:"card-title text-5xl font-bold font-mono flex items-center gap-4"},Ye={key:0},Ze={key:1},et={class:"w-full px-4 mb-4"},tt={class:"h-16 rounded-xl flex items-center justify-center text-3xl font-bold font-mono bg-base-200 border-2 transition-colors border-base-300"},nt={key:0,class:"animate-pulse text-base-content/20"},st={class:"mt-auto w-full"},ot={key:0},at={key:0};function rt(f,o,a,e,s,l){return e.finished?(i(),K(e.Summary,{key:1,results:e.finalResults,totalTime:e.finalTotalTime,storageKey:a.storageKey,onRestart:e.handleRestart},{question:A(({result:n})=>[T(e.MathDisplay,{value:n.question.display},null,8,["value"])]),userAnswer:A(({result:n})=>[n.question.type==="toPercentage"?(i(),m("span",ot,h(n.userAnswer)+"%",1)):(i(),K(e.MathDisplay,{key:1,value:`${n.userAnswer}\\1`},null,8,["value"]))]),correctAnswer:A(({result:n})=>[n.question.type==="toPercentage"?(i(),m("span",at,h(n.question.answer)+"%",1)):(i(),K(e.MathDisplay,{key:1,value:`${n.question.answer}\\1`},null,8,["value"]))]),_:1},8,["results","totalTime","storageKey"])):(i(),K(e.BaseTraining,{key:0,storageKey:a.storageKey,numQuestions:a.numQuestions,generateQuestion:e.generateQuestion,isRight:e.isRight,onComplete:e.handleComplete},{description:A(()=>[...o[0]||(o[0]=[t("h2",{class:"card-title text-3xl font-bold mb-6"},"分数与百分比转换",-1),t("div",{class:"text-left w-full mb-8"},[t("div",{class:"bg-base-200 p-5 rounded-2xl"},[t("div",{class:"flex items-center gap-2 mb-4 text-base-content/80"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"stroke-current shrink-0 w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),t("h3",{class:"font-bold text-lg"},"题型说明")]),t("div",{class:"space-y-3"},[t("div",{class:"bg-base-100 p-4 rounded-xl border border-base-300/50 shadow-sm flex flex-col gap-1"},[t("div",{class:"font-bold text-base flex items-center gap-2"},[t("span",{class:"badge badge-primary badge-sm"},"1"),C(" 分数 ➔ 百分比 ")]),t("div",{class:"text-sm opacity-80 pl-7"},[C(" 如 "),t("span",{class:"font-mono font-bold mx-1"},"1/3"),C(" 需输入 "),t("span",{class:"font-mono font-bold mx-1"},"33.3"),t("div",{class:"text-xs text-warning mt-1 font-medium"},"* 至少精确到一位小数")])]),t("div",{class:"bg-base-100 p-4 rounded-xl border border-base-300/50 shadow-sm flex flex-col gap-1"},[t("div",{class:"font-bold text-base flex items-center gap-2"},[t("span",{class:"badge badge-secondary badge-sm"},"2"),C(" 百分比/小数 ➔ 分数 ")]),t("div",{class:"text-sm opacity-80 pl-7"},[C(" 如 "),t("span",{class:"font-mono font-bold mx-1"},"5%"),C(" 需输入 "),t("span",{class:"font-mono font-bold mx-1"},"20"),t("div",{class:"text-xs opacity-60 mt-1"},"(即 1/20 的分母)")])])])])],-1)])]),default:A(({question:n,confirm:r})=>[t("div",Ue,[t("div",We,[t("h2",Xe,[T(e.MathDisplay,{value:n.display},null,8,["value"]),o[1]||(o[1]=t("span",null,"=",-1)),n.type==="toPercentage"?(i(),m("span",Ye,"? %")):(i(),m("span",Ze,[T(e.MathDisplay,{value:"? \\ 1"})]))])])]),t("div",et,[t("div",tt,[n.type==="toPercentage"?(i(),m(P,{key:0},[T(e.MathDisplay,{value:e.currentInput},null,8,["value"]),e.currentInput?q("",!0):(i(),m("span",nt,"|")),o[2]||(o[2]=t("span",{class:"text-base-content/50 ml-1"},"%",-1))],64)):(i(),K(e.MathDisplay,{key:1,value:`${e.currentInput||"|"}\\1`},null,8,["value"]))])]),t("div",st,[T(e.VirtualKeypad,{onInput:e.handleInput,onDelete:e.handleDelete,onConfirm:()=>e.handleConfirm(r)},null,8,["onConfirm"])])]),_:1},8,["storageKey","numQuestions"]))}const ut=Q(Je,[["render",rt]]);export{ut as default};
