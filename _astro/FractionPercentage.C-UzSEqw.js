import{_ as B}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{d as F,c as p,o as l,a as e,F as A,r as N,t as v,e as H,f as j,n as E,g as T,h as P,i as k,j as $,m as G,b as _,k as J,l as S,s as V,p as Q,q as I}from"./runtime-core.esm-bundler.DhsM4LcL.js";import{n as W}from"./router.BSJf0dKq.js";const X=F({__name:"VirtualKeypad",emits:["input","delete","confirm"],setup(d,{expose:s,emit:o}){s();const t=o,a=["1","2","3","4","5","6","7","8","9",".","0","\\"],i=m=>{t("input",m)},n=()=>{t("delete")},r=()=>{t("confirm")},c=m=>{a.includes(m.key)?i(m.key):m.key==="Backspace"?n():m.key==="Enter"&&r()};H(()=>{window.addEventListener("keydown",c)}),j(()=>{window.removeEventListener("keydown",c)});const u={emit:t,keys:a,handleInput:i,handleDelete:n,handleConfirm:r,handleKeyboard:c};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}}),Y={class:"grid grid-cols-3 gap-2 p-4 bg-base-100 rounded-t-2xl shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] fixed bottom-0 left-0 right-0 w-full max-w-md mx-auto z-50 pb-8"},Z=["onClick"];function ee(d,s,o,t,a,i){return l(),p("div",Y,[(l(),p(A,null,N(t.keys,n=>e("button",{key:n,onClick:r=>t.handleInput(n),class:"btn btn-lg text-2xl font-bold bg-base-200 hover:bg-base-300 border-none shadow-sm active:scale-95 transition-transform"},v(n==="\\"?"分之":n),9,Z)),64)),e("button",{onClick:t.handleDelete,class:"btn btn-lg text-xl font-bold bg-error/10 text-error hover:bg-error/20 border-none shadow-sm active:scale-95 transition-transform"}," ⌫ "),e("button",{onClick:t.handleConfirm,class:"btn btn-lg text-xl font-bold bg-primary text-primary-content hover:bg-primary-focus border-none shadow-sm col-span-2 active:scale-95 transition-transform"}," 确定 ")])}const te=B(X,[["render",ee]]),ne=F({__name:"Summary",props:{results:{},totalTime:{}},setup(d,{expose:s}){s();const o=d,t=P(()=>o.results.filter(u=>u.isCorrect).length),a=P(()=>o.results.length-t.value),i=P(()=>o.results.length===0?0:Math.round(t.value/o.results.length*100)),c={props:o,correctCount:t,wrongCount:a,accuracy:i,formatTime:u=>{const m=Math.floor(u/6e4).toString().padStart(2,"0"),y=Math.floor(u%6e4/1e3).toString().padStart(2,"0"),C=(u%1e3).toString().padStart(3,"0");return`${m}:${y}.${C}`},homeUrl:"/calc-deploy"};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}}),se={class:"flex flex-col h-dvh gap-6 p-4 w-full max-w-2xl mx-auto"},oe={class:"stats shadow w-full bg-base-100 flex-none"},re={class:"stat place-items-center"},ae={class:"stat-value text-primary"},le={class:"stat place-items-center"},ie={class:"stat-desc"},ce={class:"overflow-y-auto flex-1 bg-base-100 rounded-box shadow"},ue={class:"table table-zebra w-full table-pin-rows"},de={class:"font-mono text-lg"},me={class:"font-mono text-lg text-base-content/70"},fe={class:"font-mono text-sm"},pe={class:"flex justify-center mt-4 flex-none"},be=["href"];function ve(d,s,o,t,a,i){return l(),p("div",se,[e("div",oe,[e("div",re,[s[0]||(s[0]=e("div",{class:"stat-title"},"总用时",-1)),e("div",ae,v(t.formatTime(o.totalTime)),1)]),e("div",le,[s[1]||(s[1]=e("div",{class:"stat-title"},"正确率",-1)),e("div",{class:E(["stat-value",t.accuracy>=80?"text-success":"text-warning"])},v(t.accuracy)+"% ",3),e("div",ie,v(t.correctCount)+" 正确, "+v(t.wrongCount)+" 错误",1)])]),e("div",ce,[e("table",ue,[s[2]||(s[2]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"问题"),e("th",null,"回答"),e("th",null,"正确答案"),e("th",null,"用时")])],-1)),e("tbody",null,[(l(!0),p(A,null,N(o.results,(n,r)=>(l(),p("tr",{key:r,class:E({"bg-error/10":!n.isCorrect})},[e("th",null,v(r+1),1),e("td",de,[T(d.$slots,"question",{result:n})]),e("td",{class:E(["font-mono text-lg font-bold",n.isCorrect?"text-success":"text-error"])},[T(d.$slots,"userAnswer",{result:n})],2),e("td",me,[T(d.$slots,"correctAnswer",{result:n})]),e("td",fe,[T(d.$slots,"timeSpent",{result:n},()=>[k(v(t.formatTime(n.timeSpent)),1)])])],2))),128))])])]),e("div",pe,[e("a",{href:t.homeUrl,class:"btn btn-primary btn-wide"},"返回首页",8,be)])])}const he=B(ne,[["render",ve]]),_e=F({__name:"MathDisplay",props:{value:{}},setup(d,{expose:s}){s();const o=d,t=P(()=>{const i=o.value;if(!i)return[{type:"text",value:""}];const n=/(?<!\\)([\d?|]+\s*\\\s*[\d?|]+)(?!\\)/g,r=[];let c=0,u;for(;(u=n.exec(i))!==null;){u.index>c&&r.push({type:"text",value:i.slice(c,u.index)});const m=u[0].split("\\");r.push({type:"fraction",denominator:m[0].trim(),numerator:m[1].trim()}),c=n.lastIndex}return c<i.length&&r.push({type:"text",value:i.slice(c)}),r}),a={props:o,segments:t};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}}),ge={class:"inline-flex items-center align-middle flex-wrap"},xe={key:0,class:"inline-flex flex-col items-center mx-[0.1em] leading-none",style:{"vertical-align":"middle"}},ye={class:"border-b-[0.08em] border-current px-[0.2em] pb-[0.1em] text-[0.75em] leading-none text-center block"},we={class:"px-[0.2em] pt-[0.1em] text-[0.75em] leading-none text-center block"},ke={key:1,class:"whitespace-pre"};function Ce(d,s,o,t,a,i){return l(),p("span",ge,[(l(!0),p(A,null,N(t.segments,(n,r)=>(l(),p(A,{key:r},[n.type==="fraction"?(l(),p("span",xe,[e("span",ye,v(n.numerator),1),e("span",we,v(n.denominator),1)])):(l(),p("span",ke,v(n.value),1))],64))),128))])}const De=B(_e,[["render",Ce]]),L=()=>{history.state?.index?history.back():W("/calc-deploy",{history:"replace"})},Se=F({__name:"TopBar",props:{startTime:{},currentQuestion:{},totalQuestions:{}},setup(d,{expose:s}){s();const o=d,t=_("00:00");let a=null;const i=()=>{L()},n=m=>{const y=Math.floor(m/60).toString().padStart(2,"0"),C=Math.floor(m%60).toString().padStart(2,"0");return`${y}:${C}`},r=()=>{a&&clearInterval(a),t.value="00:00",a=window.setInterval(()=>{o.startTime&&(t.value=n((Date.now()-o.startTime)/1e3))},100)},c=()=>{a&&(clearInterval(a),a=null)};J(()=>{o.startTime&&r()}),j(()=>{c()});const u={props:o,time:t,get timerInterval(){return a},set timerInterval(m){a=m},goBack:i,formatTime:n,startTimer:r,stopTimer:c};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}}),Te={class:"flex-none flex items-center gap-4"},Be={key:0,class:"text-sm uppercase tracking-widest opacity-50"},Fe={class:"font-mono text-xl font-bold text-primary"};function Me(d,s,o,t,a,i){return l(),p("div",G(d.$attrs,{class:"navbar bg-base-100 shadow-md px-4 min-h-12"}),[e("div",{class:"flex-1"},[e("button",{onClick:t.goBack,class:"btn btn-ghost btn-sm gap-2"},[...s[0]||(s[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-5 h-5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})],-1),k(" 返回 ",-1)])])]),e("div",Te,[o.totalQuestions?(l(),p("div",Be,v(o.currentQuestion)+" / "+v(o.totalQuestions),1)):$("",!0),e("div",Fe,v(t.time),1)])],16)}const Qe=B(Se,[["render",Me]]),Ie=F({__name:"BaseTraining",props:{numQuestions:{},generateQuestion:{type:Function},isRight:{type:Function},storageKey:{}},emits:["complete"],setup(d,{expose:s,emit:o}){s();const t=d,a=o,i=_(!1),n=V([]),r=_(0),c=_("none"),u=_(0),m=_(0),y=V([]),C=_(null);let g=null;const f=()=>{g=h=>{h.preventDefault(),C.value?.showModal()},document.addEventListener("astro:before-preparation",g)},b=()=>{g&&(document.removeEventListener("astro:before-preparation",g),g=null)},w=()=>{b(),L()},D=()=>{i.value=!0;const h=[];for(let M=0;M<t.numQuestions;M++)h.push(t.generateQuestion());n.value=h,u.value=Date.now(),m.value=Date.now(),r.value=0,f()},x=P(()=>{if(n.value.length!==0)return n.value[r.value]}),O=h=>{if(c.value!=="none"||!x.value)return Promise.resolve();const M=x.value,R=t.isRight(M,h),z=Date.now()-m.value;return y.value.push({question:M,userAnswer:h,isCorrect:R,timeSpent:z}),c.value=R?"correct":"wrong",new Promise(U=>{setTimeout(()=>{c.value="none",U(),r.value<n.value.length-1?(r.value++,m.value=Date.now()):q()},500)})},q=()=>{b();const h=Date.now()-u.value;a("complete",y.value,h)};j(()=>{b()});const K={props:t,emit:a,started:i,questions:n,currentQuestionIndex:r,feedback:c,startTime:u,questionStartTime:m,results:y,confirmModal:C,get navigationHandler(){return g},set navigationHandler(h){g=h},setupNavigationInterception:f,cleanupNavigationInterception:b,performNavigation:w,startTraining:D,currentQuestion:x,handleConfirm:O,finish:q,TopBar:Qe};return Object.defineProperty(K,"__isScriptSetup",{enumerable:!1,value:!0}),K}}),Ee={class:"flex flex-col items-center w-full flex-1 relative"},Pe={key:0,class:"card w-full bg-base-100 shadow-xl"},$e={class:"card-body items-center text-center"},Ae={key:1,class:"w-full flex flex-col items-center flex-1"},Ne={key:2,class:"absolute inset-0 flex items-center justify-center z-10 pointer-events-none"},je={ref:"confirmModal",class:"modal"};function qe(d,s,o,t,a,i){return l(),p("div",Ee,[S(t.TopBar,{startTime:t.startTime,currentQuestion:t.currentQuestionIndex+1,totalQuestions:o.numQuestions,class:"w-full mb-6"},null,8,["startTime","currentQuestion","totalQuestions"]),t.started?$("",!0):(l(),p("div",Pe,[e("div",$e,[T(d.$slots,"description"),e("div",{class:"card-actions mt-8"},[e("button",{class:"btn btn-primary btn-lg btn-wide",onClick:t.startTraining},"开始训练")])])])),t.started&&t.currentQuestion?(l(),p("div",Ae,[T(d.$slots,"default",{question:t.currentQuestion,feedback:t.feedback,confirm:t.handleConfirm})])):$("",!0),t.feedback!=="none"?(l(),p("div",Ne,[e("div",{class:E(["text-9xl font-black drop-shadow-lg transform transition-all scale-150",t.feedback==="correct"?"text-success":"text-error"])},v(t.feedback==="correct"?"✓":"✗"),3)])):$("",!0),e("dialog",je,[e("div",{class:"modal-box"},[s[1]||(s[1]=e("h3",{class:"font-bold text-lg"},"提示",-1)),s[2]||(s[2]=e("p",{class:"py-4"},"确定要退出训练吗？当前进度将丢失。",-1)),e("div",{class:"modal-action"},[e("form",{method:"dialog"},[s[0]||(s[0]=e("button",{class:"btn"},"取消",-1)),e("button",{class:"btn btn-error ml-2",onClick:t.performNavigation},"确定退出")])])]),s[3]||(s[3]=e("form",{method:"dialog",class:"modal-backdrop"},[e("button",null,"close")],-1))],512)])}const Ke=B(Ie,[["render",qe]]),Re=F({__name:"FractionPercentage",props:{numQuestions:{},storageKey:{}},setup(d,{expose:s}){s();const o=_(""),t=_(!1),a=_([]),i=_(0),n=f=>Number.isInteger(f)?f.toString():Number.isInteger(f*10)?f.toFixed(1):parseFloat(f.toFixed(2)).toString(),g={currentInput:o,finished:t,finalResults:a,finalTotalTime:i,formatNumber:n,generateQuestion:()=>{const f=Math.random()>.5?"toPercentage":"toFraction",b=Math.floor(Math.random()*19)+2,w=1/b;if(f==="toPercentage"){const D=w*100,x=Math.round(D*10)/10;return{display:`${b}\\1`,answer:x.toString(),type:"toPercentage"}}else{const D=Math.random()>.5;let x="";return D?x=`${n(w*100)}%`:x=parseFloat(w.toFixed(3)).toString(),{display:x,answer:b.toString(),type:"toFraction"}}},isRight:(f,b)=>{if(f.type==="toPercentage"){const w=parseFloat(b),D=parseFloat(f.answer);return isNaN(w)?!1:Math.abs(w-D)<.06}else return parseInt(b)===parseInt(f.answer)},handleComplete:(f,b)=>{a.value=f,i.value=b,t.value=!0},handleInput:(f,b)=>{b==="none"&&(o.value+=f)},handleDelete:f=>{f==="none"&&(o.value=o.value.slice(0,-1))},handleConfirm:async(f,b)=>{o.value===""||b!=="none"||(await f(o.value),o.value="")},VirtualKeypad:te,Summary:he,MathDisplay:De,BaseTraining:Ke};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}}),Ve={class:"card w-full bg-base-100 shadow-xl mb-8"},Le={class:"card-body items-center text-center py-12"},Oe={class:"card-title text-5xl font-bold font-mono flex items-center gap-4"},ze={key:0},Ue={key:1},He={class:"w-full px-4 mb-4"},Ge={key:0,class:"animate-pulse text-base-content/20"},Je={class:"mt-auto w-full"},We={key:0},Xe={key:0};function Ye(d,s,o,t,a,i){return t.finished?(l(),Q(t.Summary,{key:1,results:t.finalResults,totalTime:t.finalTotalTime},{question:I(({result:n})=>[S(t.MathDisplay,{value:n.question.display},null,8,["value"])]),userAnswer:I(({result:n})=>[n.question.type==="toPercentage"?(l(),p("span",We,v(n.userAnswer)+"%",1)):(l(),Q(t.MathDisplay,{key:1,value:`${n.userAnswer}\\1`},null,8,["value"]))]),correctAnswer:I(({result:n})=>[n.question.type==="toPercentage"?(l(),p("span",Xe,v(n.question.answer)+"%",1)):(l(),Q(t.MathDisplay,{key:1,value:`${n.question.answer}\\1`},null,8,["value"]))]),_:1},8,["results","totalTime"])):(l(),Q(t.BaseTraining,{key:0,storageKey:o.storageKey,numQuestions:o.numQuestions,generateQuestion:t.generateQuestion,isRight:t.isRight,onComplete:t.handleComplete},{description:I(()=>[...s[0]||(s[0]=[e("h2",{class:"card-title text-3xl font-bold mb-6"},"分数与百分比转换",-1),e("div",{class:"text-left w-full mb-8"},[e("div",{class:"bg-base-200 p-5 rounded-2xl"},[e("div",{class:"flex items-center gap-2 mb-4 text-base-content/80"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"stroke-current shrink-0 w-6 h-6"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("h3",{class:"font-bold text-lg"},"题型说明")]),e("div",{class:"space-y-3"},[e("div",{class:"bg-base-100 p-4 rounded-xl border border-base-300/50 shadow-sm flex flex-col gap-1"},[e("div",{class:"font-bold text-base flex items-center gap-2"},[e("span",{class:"badge badge-primary badge-sm"},"1"),k(" 分数 ➔ 百分比 ")]),e("div",{class:"text-sm opacity-80 pl-7"},[k(" 如 "),e("span",{class:"font-mono font-bold mx-1"},"1/3"),k(" 需输入 "),e("span",{class:"font-mono font-bold mx-1"},"33.3"),e("div",{class:"text-xs text-warning mt-1 font-medium"},"* 至少精确到一位小数")])]),e("div",{class:"bg-base-100 p-4 rounded-xl border border-base-300/50 shadow-sm flex flex-col gap-1"},[e("div",{class:"font-bold text-base flex items-center gap-2"},[e("span",{class:"badge badge-secondary badge-sm"},"2"),k(" 百分比/小数 ➔ 分数 ")]),e("div",{class:"text-sm opacity-80 pl-7"},[k(" 如 "),e("span",{class:"font-mono font-bold mx-1"},"5%"),k(" 需输入 "),e("span",{class:"font-mono font-bold mx-1"},"20"),e("div",{class:"text-xs opacity-60 mt-1"},"(即 1/20 的分母)")])])])])],-1)])]),default:I(({question:n,feedback:r,confirm:c})=>[e("div",Ve,[e("div",Le,[e("h2",Oe,[S(t.MathDisplay,{value:n.display},null,8,["value"]),s[1]||(s[1]=e("span",null,"=",-1)),n.type==="toPercentage"?(l(),p("span",ze,"? %")):(l(),p("span",Ue,[S(t.MathDisplay,{value:"? \\ 1"})]))])])]),e("div",He,[e("div",{class:E(["h-16 rounded-xl flex items-center justify-center text-3xl font-bold font-mono bg-base-200 border-2 transition-colors",{"border-base-300":r==="none","border-success bg-success/10 text-success":r==="correct","border-error bg-error/10 text-error":r==="wrong"}])},[n.type==="toPercentage"?(l(),p(A,{key:0},[S(t.MathDisplay,{value:t.currentInput},null,8,["value"]),t.currentInput?$("",!0):(l(),p("span",Ge,"|")),s[2]||(s[2]=e("span",{class:"text-base-content/50 ml-1"},"%",-1))],64)):(l(),Q(t.MathDisplay,{key:1,value:`${t.currentInput||"|"}\\1`},null,8,["value"]))],2)]),e("div",Je,[S(t.VirtualKeypad,{onInput:u=>t.handleInput(u,r),onDelete:()=>t.handleDelete(r),onConfirm:()=>t.handleConfirm(c,r)},null,8,["onInput","onDelete","onConfirm"])])]),_:1},8,["storageKey","numQuestions"]))}const nt=B(Re,[["render",Ye]]);export{nt as default};
